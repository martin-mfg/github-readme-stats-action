name: Action E2E

on:
  push:
    branches: [main]
  pull_request:
  workflow_dispatch:

jobs:
  e2e:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 22

      - name: Generate stats card
        uses: ./
        with:
          card: stats
          options: username=${{ github.repository_owner }}&show_icons=true
          path: build/stats.svg
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Generate top languages card
        uses: ./
        with:
          card: top-langs
          options: username=${{ github.repository_owner }}&layout=compact&langs_count=6
          path: build/top-langs.svg
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Generate pin card
        uses: ./
        with:
          card: pin
          options: username=readme-tools&repo=github-readme-stats
          path: build/pin-readme-tools-github-readme-stats.svg
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Generate WakaTime card
        uses: ./
        with:
          card: wakatime
          options: username=MNZ&layout=compact # Used active username from leaderboard
          path: build/wakatime.svg
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Verify SVG output
        run: |
          rg -n "<svg" build/stats.svg
          rg -n "<svg" build/top-langs.svg
          rg -n "<svg" build/pin-readme-tools-github-readme-stats.svg
          rg -n "<svg" build/wakatime.svg
        shell: bash
